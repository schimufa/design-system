#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit validation..."

# Format code first
echo "ğŸ“ Formatting code..."
npm run format

# Run design system contribution validation
echo "ğŸ¨ Validating design system contribution..."
cd packages/design-system
if ! pnpm validate-contribution; then
    echo ""
    echo "âŒ Design system contribution validation failed!"
    echo "Please fix the issues above before committing."
    echo ""
    echo "ğŸ’¡ Common fixes:"
    echo "  - Run 'pnpm build' to fix TypeScript errors"
    echo "  - Run 'pnpm lint --fix' to fix linting issues"
    echo "  - Run 'pnpm test' to fix failing tests"
    echo "  - Add missing component files (index.tsx, stories, tests)"
    echo ""
    exit 1
fi

# Go back to root
cd ../..

# Run linting
echo "ğŸ§¹ Running linter..."
if ! pnpm lint; then
    echo ""
    echo "âŒ Linting failed!"
    echo "Please fix linting errors before committing."
    echo "Run 'pnpm lint --fix' to auto-fix issues."
    echo ""
    exit 1
fi

# Run type checking
echo "ğŸ”· Running type check..."
if ! pnpm typecheck; then
    echo ""
    echo "âŒ Type checking failed!"
    echo "Please fix TypeScript errors before committing."
    echo ""
    exit 1
fi

echo "âœ… All pre-commit checks passed!"
echo "ğŸš€ Ready to commit!" 